import{j as e,a9 as k,l as f,dn as Q,h as A,I as P,n as U,z as F,o as _,d$ as Y,e0 as q,aa as K,e1 as V,B as R,r as L,q as Z,u as v,e2 as J,e3 as X,bm as ee,aL as m,cE as S,bq as te,a$ as se,v as ne,aU as O,a as ae,ar as ie,b2 as re,b as oe,ae as le,aI as ce,e4 as de,e5 as ue,e6 as pe,e7 as ge,e8 as he,aO as fe,aS as me,d as E,aT as w,L as ye,cG as xe,e9 as C}from"./strapi-YAFrxjfj.js";import{u as Te}from"./useDragLayer-BZGQluBr.js";import{C as je}from"./CardDragPreview-DmZz1BJ1.js";import{u as N,a as Le}from"./hooks-D8O9Ho7E.js";function be(s,i,n){if(!s||!i||!n)return{display:"none"};const{x:t,y:u}=n;return{transform:`translate(${t}px, ${u}px)`}}const Se=({renderItem:s})=>{const{itemType:i,isDragging:n,item:t,initialOffset:u,currentOffset:l,mouseOffset:p}=Te(r=>({item:r.getItem(),itemType:r.getItemType(),initialOffset:r.getInitialSourceClientOffset(),currentOffset:r.getSourceClientOffset(),isDragging:r.isDragging(),mouseOffset:r.getClientOffset()}));return n?e.jsx(k,{height:"100%",left:0,position:"fixed",pointerEvents:"none",top:0,zIndex:100,width:"100%",children:e.jsx(k,{style:be(u,l,p),children:s({type:i,item:t})})}):null},Ce=({displayedValue:s})=>e.jsxs(f,{background:"neutral0",borderColor:"neutral200",justifyContent:"space-between",gap:3,padding:3,width:"30rem",children:[e.jsx(Me,{type:"button",children:e.jsxs(f,{gap:6,children:[e.jsx(Ie,{alignItems:"center",justifyContent:"center",background:"neutral200",height:"3.2rem",width:"3.2rem",children:e.jsx(Q,{})}),e.jsx(f,{maxWidth:"15rem",children:e.jsx(A,{textColor:"neutral700",ellipsis:!0,children:s})})]})}),e.jsxs(f,{gap:2,children:[e.jsx(P,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(U,{})}),e.jsx(P,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(F,{})})]})]}),Ie=_(f)`
  border-radius: 50%;

  svg {
    height: 0.6rem;
    width: 1.1rem;
    > path {
      fill: ${({theme:s})=>s.colors.neutral600};
    }
  }
`,Me=_.button`
  border: none;
  background: transparent;
  display: block;
  width: 100%;
  text-align: unset;
  padding: 0;
`,ke=({status:s,displayedValue:i,width:n})=>e.jsx(k,{style:{width:n},children:e.jsxs(f,{paddingTop:2,paddingBottom:2,paddingLeft:2,paddingRight:4,hasRadius:!0,borderWidth:1,background:"neutral0",borderColor:"neutral200",justifyContent:"space-between",gap:4,children:[e.jsxs(Y,{gap:1,children:[e.jsx(P,{withTooltip:!1,label:"",variant:"ghost",children:e.jsx(F,{})}),e.jsxs(f,{width:"100%",minWidth:0,justifyContent:"space-between",children:[e.jsx(k,{minWidth:0,paddingTop:1,paddingBottom:1,paddingRight:4,children:e.jsx(q,{href:"",children:e.jsx(A,{textColor:"primary600",ellipsis:!0,children:i})})}),s?e.jsx(K,{status:s}):null]})]}),e.jsx(V,{type:"button",children:e.jsx(R,{width:"12px"})})]})}),De=()=>{const[s,i]=L.useState(""),[{query:n}]=Z(),{formatMessage:t,locale:u}=v(),l=N(c=>c["content-manager"].app.collectionTypeLinks),p=N(c=>c["content-manager"].app.singleTypeLinks),{schemas:r}=J(),{startsWith:a}=X(u,{sensitivity:"base"}),o=ee(u,{sensitivity:"base"}),b=L.useMemo(()=>[{id:"collectionTypes",title:t({id:m("components.LeftMenu.collection-types"),defaultMessage:"Collection Types"}),searchable:!0,links:l},{id:"singleTypes",title:t({id:m("components.LeftMenu.single-types"),defaultMessage:"Single Types"}),searchable:!0,links:p}].map(c=>({...c,links:c.links.filter(d=>a(d.title,s)).sort((d,x)=>o.compare(d.title,x.title)).map(d=>({...d,title:t({id:d.title,defaultMessage:d.title})}))})),[l,s,p,a,t,o]),g=()=>{i("")},y=({target:{value:c}})=>{i(c)},I=t({id:m("header.name"),defaultMessage:"Content Manager"}),D=c=>{const x=!!r.find(T=>T.uid===c.uid)?.pluginOptions?.i18n?.localized;if(n.plugins&&"i18n"in n.plugins){const{i18n:T,...M}=n.plugins;return x?{i18n:T,...M}:M}return n.plugins};return e.jsxs(S.Main,{"aria-label":I,children:[e.jsx(S.Header,{label:I}),e.jsx(te,{background:"neutral150"}),e.jsx(f,{padding:5,gap:3,direction:"column",alignItems:"stretch",children:e.jsx(se,{startAction:e.jsx(ne,{fill:"neutral500"}),value:s,onChange:y,"aria-label":"Search",placeholder:t({id:"content-manager.components.LeftMenu.Search.label",defaultMessage:"Search for a content type"}),endAction:e.jsx(R,{onClick:g,fill:"neutral500",cursor:"pointer"}),size:"S"})}),e.jsx(S.Sections,{children:b.map(c=>e.jsx(S.Section,{label:c.title,children:c.links.map(d=>e.jsx(S.Link,{to:{pathname:d.to,search:O.stringify({...O.parse(d.search??""),plugins:D(d)})},label:d.title},d.uid))},c.id))})]})},{MUTATE_COLLECTION_TYPES_LINKS:Ee,MUTATE_SINGLE_TYPES_LINKS:we}=ue,Pe=()=>{const{toggleNotification:s}=ae(),i=Le(),n=ie("useContentManagerInitData",g=>g.runHookWaterfall),{notifyStatus:t}=re(),{formatMessage:u}=v(),{_unstableFormatAPIError:l}=oe(m),p=le("useContentManagerInitData",g=>g.checkUserHasPermissions),r=N(g=>g["content-manager"].app),a=ce(void 0,{refetchOnMountOrArgChange:!0});L.useEffect(()=>{a.data&&t(u({id:m("App.schemas.data-loaded"),defaultMessage:"The schemas have been successfully loaded."}))},[u,a.data,t]),L.useEffect(()=>{a.error&&s({type:"danger",message:l(a.error)})},[l,a.error,s]);const o=de();L.useEffect(()=>{o.error&&s({type:"danger",message:l(o.error)})},[l,o.error,s]);const b=async(g,y,I,D)=>{const{collectionType:c,singleType:d}=y.reduce((h,j)=>(h[j.kind].push(j),h),{collectionType:[],singleType:[]}),x=$(c,"collectionTypes",D),T=$(d,"singleTypes"),M=await Promise.all(x.map(({permissions:h})=>p(h))),z=x.filter((h,j)=>M[j].length>0),B=await Promise.all(T.map(({permissions:h})=>p(h))),W=T.filter((h,j)=>B[j].length>0),{ctLinks:H}=n(Ee,{ctLinks:z,models:y}),{stLinks:G}=n(we,{stLinks:W,models:y});i(pe({authorizedCollectionTypeLinks:H,authorizedSingleTypeLinks:G,components:g,contentTypeSchemas:y,fieldSizes:I}))};return L.useEffect(()=>{a.data&&o.data&&b(a.data.components,a.data.contentTypes,a.data.fieldSizes,o.data)},[a.data,o.data]),{...r}},$=(s,i,n=[])=>s.filter(t=>t.isDisplayed).map(t=>{const u=[{action:"plugin::content-manager.explorer.create",subject:t.uid},{action:"plugin::content-manager.explorer.read",subject:t.uid}],l=[{action:"plugin::content-manager.explorer.read",subject:t.uid}],p=i==="collectionTypes"?u:l,r=n.find(({uid:o})=>o===t.uid);let a=null;if(r){const o={page:1,pageSize:r.settings.pageSize,sort:`${r.settings.defaultSortBy}:${r.settings.defaultSortOrder}`};a=O.stringify(o,{encode:!1})}return{permissions:p,search:a,kind:t.kind,title:t.info.displayName,to:`/content-manager/${t.kind==="collectionType"?ge:he}/${t.uid}`,uid:t.uid,name:t.uid,isDisplayed:t.isDisplayed}}),Fe=()=>{const s=fe("/content-manager/:kind/:uid/*"),{isLoading:i,collectionTypeLinks:n,models:t,singleTypeLinks:u}=Pe(),l=[...n,...u].sort((o,b)=>o.title.localeCompare(b.title)),{pathname:p}=me(),{formatMessage:r}=v();if(i)return e.jsxs(e.Fragment,{children:[e.jsx(E.Title,{children:r({id:m("plugin.name"),defaultMessage:"Content Manager"})}),e.jsx(E.Loading,{})]});const a=t.filter(({isDisplayed:o})=>o);return l.length===0&&a.length>0&&p!=="/content-manager/403"?e.jsx(w,{to:"/403"}):a.length===0&&p!=="/no-content-types"?e.jsx(w,{to:"/no-content-types"}):!s&&l.length>0?e.jsx(w,{to:{pathname:l[0].to,search:l[0].search??""},replace:!0}):e.jsxs(e.Fragment,{children:[e.jsx(E.Title,{children:r({id:m("plugin.name"),defaultMessage:"Content Manager"})}),e.jsxs(ye.Root,{sideNav:e.jsx(De,{}),children:[e.jsx(Se,{renderItem:Oe}),e.jsx(xe,{})]})]})};function Oe({type:s,item:i}){if(!s||s&&typeof s!="string")return null;const[n]=s.split("_");switch(n){case C.EDIT_FIELD:case C.FIELD:return e.jsx(je,{label:i.label});case C.COMPONENT:case C.DYNAMIC_ZONE:return e.jsx(Ce,{displayedValue:i.displayedValue});case C.RELATION:return e.jsx(ke,{...i});default:return null}}export{Fe as Layout};
